{
	"name": "CP_CNTRCT_CHNG_RPT",
	"properties": {
		"description": "Job creation:05-06-2022\nJob name: Df_BAL0001_GEO_DIM\nCreatedBy: Varaprasad",
		"folder": {
			"name": "PGMP"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"linkedService": {
						"referenceName": "ls_pgmp_rfs_db",
						"type": "LinkedServiceReference"
					},
					"name": "Srccntrchnagrpt"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "ls_pgmp_rfs_db",
						"type": "LinkedServiceReference"
					},
					"name": "tgtcntrctchngrpt"
				}
			],
			"transformations": [
				{
					"name": "AlterRow1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          CNTRCT_DIM_UID as integer,",
				"          CONTRACT as string,",
				"          UNIQUE_ID as integer,",
				"          DISPLAY_ID as string,",
				"          GLBL_BUY_GRP_ID as string,",
				"          PARENT_UNIQUE_ID as integer,",
				"          PARENT_DISPLAY_ID as string,",
				"          PARENT_TITLE as string,",
				"          CLIENT_REFERENCE as string,",
				"          PROC_TITLE as string,",
				"          PROC_DESCRIPTION as string,",
				"          CURRENT_WORKFLOW as string,",
				"          CURRENT_WKFLW_STEP as string,",
				"          CURRENT_STEP_SEQ as integer,",
				"          STEP_DESCRIPTION as string,",
				"          STATE_DESC as string,",
				"          STATUS_DESC as string,",
				"          ON_HOLD_DESC as string,",
				"          ON_HOLD_DT as date,",
				"          ON_HOLD_RSN_TXT as string,",
				"          ADTNL_DTLS_FOR_WITHDRW_HOLD_TXT as string,",
				"          AUDIENCE as string,",
				"          PRIORITY_TXT as string,",
				"          CONDITION as string,",
				"          REGION as string,",
				"          REQUESTOR as string,",
				"          COUNTRY as string,",
				"          AGREEMENT_REFERENCE_DETAILS as string,",
				"          ORIGINATING_ORG as string,",
				"          CREATED_DATE as timestamp,",
				"          LAST_UPDATED as timestamp,",
				"          DUE_DT as date,",
				"          RVSD_DUE_DT as date,",
				"          IBM_APPRVL_SIGNED_DT as date,",
				"          CLNT_APPRVL_SIGNED_DT as date,",
				"          CNTRCT_EX_DT as date,",
				"          COMPLETION_DATE as date,",
				"          CMPLTD_RSN_TXT as string,",
				"          CNTRCT_DELVRBL_CNFRMN_IND as string,",
				"          FRML_AMNDMNT_NBR_TXT as string,",
				"          CNTRCT_BSLN_CNFRMN_IND as string,",
				"          STAFFG_SKILL_CNFRMN_IND as string,",
				"          FIN_CNFRMN_IND as string,",
				"          RJCT_RSN_ID as integer,",
				"          RJCT_EXPLNN_TXT as string,",
				"          CNTRCT_REM_TXT as string,",
				"          RJCT_RSN_TXT as string,",
				"          SRC_SYS_CD as string,",
				"          LEGACY_UNIQUE_ID as string,",
				"          LEGACY_DISPLAYED_ID as string,",
				"          LATEST_IBM_ONLY_NOTE as string,",
				"          LATEST_IBM_AND_CLIENT_NOTE as string,",
				"          CNTRCT_TYPE_DESC as string,",
				"          PROC_TYPE_ID as string,",
				"          PROC_TYPE_DESC as string,",
				"          ON_HOLD_CD as string,",
				"          WITHDRWN_DIM_UID as integer,",
				"          WITHDRWN_DT as date,",
				"          ORGNZN_DIM_UID as integer,",
				"          IBM_ONLY_TEXT_1 as string,",
				"          IBM_ONLY_TEXT_2 as string,",
				"          IBM_ONLY_TEXT_3 as string,",
				"          IBM_ONLY_TEXT_4 as string,",
				"          IBM_ONLY_TEXT_5 as string,",
				"          IBM_ONLY_TEXT_6 as string,",
				"          IBM_ONLY_DATE_1 as date,",
				"          IBM_ONLY_DATE_2 as date,",
				"          IBM_ONLY_DATE_3 as date,",
				"          IBM_ONLY_DATE_4 as date,",
				"          IBM_ONLY_DATE_5 as date,",
				"          IBM_ONLY_DATE_6 as date,",
				"          PUBLIC_TEXT_1 as string,",
				"          PUBLIC_TEXT_2 as string,",
				"          PUBLIC_TEXT_3 as string,",
				"          PUBLIC_TEXT_4 as string,",
				"          PUBLIC_TEXT_5 as string,",
				"          PUBLIC_TEXT_6 as string,",
				"          PUBLIC_DATE_1 as date,",
				"          PUBLIC_DATE_2 as date,",
				"          PUBLIC_DATE_3 as date,",
				"          PUBLIC_DATE_4 as date,",
				"          PUBLIC_DATE_5 as date,",
				"          PUBLIC_DATE_6 as date,",
				"          STATE_OF_ORGANIZATION as string,",
				"          SCTR_NM as string,",
				"          CLIENT_UNIT as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'query',",
				"     store: 'sqlserver',",
				"     query: 'SELECT \\nC.CNTRCT_DIM_UID,\\nC.CNTRCT_NM AS CONTRACT,\\nH.PROC_DIM_UID AS UNIQUE_ID,\\nP.PROC_DSPLY_ID AS DISPLAY_ID,\\nZ.GLBL_BUY_GRP_ID,\\nPC.PROC_DIM_UID AS PARENT_UNIQUE_ID,  \\nPC.PROC_DSPLY_ID AS PARENT_DISPLAY_ID,\\nPC.TITLE_TXT AS PARENT_TITLE,\\nP.CLNT_REF_NUM AS CLIENT_REFERENCE,\\n--I.WKFLW_DEF_ID,\\n--I.\"DESC\"  as  INIT_WKFLW_DEF_ID_DESCR,\\nP.TITLE_TXT AS PROC_TITLE,\\nP.PROC_DESC AS PROC_DESCRIPTION,\\nW.WKFLW_DEF_ID AS CURRENT_WORKFLOW,\\nWS.WKFLW_STEP_DEF_ID AS CURRENT_WKFLW_STEP,\\nWS.WKFLW_STEP_SEQ_NUM AS CURRENT_STEP_SEQ,\\nWS.WKFLW_STEP_DESC AS STEP_DESCRIPTION,\\nST.STATE_TITLE_TXT STATE_DESC,\\nS.STAT_IBM_DESC AS STATUS_DESC,\\nO.ON_HOLD_DESC, \\nH.ON_HOLD_DT,\\nHR.ON_HOLD_RSN_TXT,\\nP.ADTNL_DTLS_FOR_WITHDRW_HOLD_TXT, \\n--decrypt_char(UD.CONCAT_NM_LOGIN,MR.MIS_REP_REF_CD) AS ASSIGNED_TO,\\nAU.ADNC_TXT AS AUDIENCE,\\nPD.PRIORITY_TXT as PRIORITY_TXT,\\nCN.COND_TXT AS CONDITION,\\nCOALESCE(RGN.REGION,GEO.KYNDRYL_RGN) AS REGION,\\n--decrypt_char(CR.CONCAT_NM_LOGIN,MR.MIS_REP_REF_CD) AS CREATED_BY,\\n--decrypt_char(P.RQSTR_TXT,\\nMR.MIS_REP_REF_CD AS REQUESTOR,\\nGEO.SRGNCTRY_NM AS COUNTRY,                                                                                                                                  \\nCC.CNTRCT_REF_TXT AS AGREEMENT_REFERENCE_DETAILS,\\nCASE CC.ORIG_ORG WHEN \\'C\\' THEN \\'Client\\' WHEN \\'I\\' THEN \\'IBM\\' WHEN \\'R\\' THEN \\'RFS\\' ELSE \\'\\' END AS ORIGINATING_ORG,\\n---decrypt_char(CC.IBM_APPRVR_TXT,MR.MIS_REP_REF_CD)  AS IBM_APPRVR_TXT,\\n--decrypt_char(CC.CLNT_APPRVR_TXT,MR.MIS_REP_REF_CD) AS CLNT_APPRVR_TXT ,     \\nH.SRC_CRETD_TMS AS CREATED_DATE,\\nH.SRC_UPDTD_TMS AS LAST_UPDATED,\\nF.DUE_DT,\\nF.RVSD_DUE_DT,\\n/*DAYS(NVL(F.DUE_DT,F.RVSD_DUE_DT)) - DAYS((CURRENT_TIMESTAMP - CURRENT_TIMEZONE) + AF.TZ HOURS) AS DUE_IN_DAY_CNT,\\nCASE WHEN DAYS(NVL(F.RVSD_DUE_DT,F.DUE_DT)) - DAYS((CURRENT_TIMESTAMP - CURRENT_TIMEZONE) + AF.TZ HOURS)  < 0 THEN \\'Y\\' ELSE \\'N\\' END AS OVERDUE,*/      \\nF.IBM_APPRVL_SIGNED_DT,\\nF.CLNT_APPRVL_SIGNED_DT,\\nF.CNTRCT_EX_DT,\\nH.CMPLTD_DT AS COMPLETION_DATE,\\nP.CMPLTD_RSN_TXT,\\nCC.CNTRCT_DELVRBL_CNFRMN_IND,\\nCC.FRML_AMNDMNT_NBR_TXT,\\nCC.CNTRCT_BSLN_CNFRMN_IND,\\nCC.STAFFG_SKILL_CNFRMN_IND,\\nCC.FIN_CNFRMN_IND,\\nCC.RJCT_RSN_ID,\\nCC.RJCT_EXPLNN_TXT,\\nCC.CNTRCT_REM_TXT,\\nCC.RJCT_RSN_TXT, \\nSR.SRC_SYS_CD,\\n\\' \\' AS LEGACY_UNIQUE_ID,\\n\\' \\' AS LEGACY_DISPLAYED_ID,\\nTRIM(SUBSTRING(ND.NOTES_DESC,1,50)) AS LATEST_IBM_ONLY_NOTE,\\nTRIM(SUBSTRING(PN.NOTES_DESC,1,50)) AS LATEST_IBM_AND_CLIENT_NOTE,\\nCT.CNTRCT_TYPE_DESC,\\nPT.PROC_TYPE_ID,\\nPT.PROC_TYPE_DESC,\\nO.ON_HOLD_CD,\\nH.WITHDRWN_DIM_UID,\\nH.WITHDRWN_DT,\\nH.ORGNZN_DIM_UID,\\nDI.IBM_ONLY_TEXT_1,\\nDI.IBM_ONLY_TEXT_2,\\nDI.IBM_ONLY_TEXT_3,\\nDI.IBM_ONLY_TEXT_4,\\nDI.IBM_ONLY_TEXT_5,\\nDI.IBM_ONLY_TEXT_6,\\nDI.IBM_ONLY_DATE_1,\\nDI.IBM_ONLY_DATE_2,\\nDI.IBM_ONLY_DATE_3,\\nDI.IBM_ONLY_DATE_4,\\nDI.IBM_ONLY_DATE_5,\\nDI.IBM_ONLY_DATE_6,\\nDP.PUBLIC_TEXT_1,\\nDP.PUBLIC_TEXT_2,\\nDP.PUBLIC_TEXT_3,\\nDP.PUBLIC_TEXT_4,\\nDP.PUBLIC_TEXT_5,\\nDP.PUBLIC_TEXT_6,\\nDP.PUBLIC_DATE_1,\\nDP.PUBLIC_DATE_2,\\nDP.PUBLIC_DATE_3,\\nDP.PUBLIC_DATE_4,\\nDP.PUBLIC_DATE_5,\\nDP.PUBLIC_DATE_6,\\nSO.STAT_OF_ORGNZN_DESC AS STATE_OF_ORGANIZATION,\\nSD.SCTR_NM,\\nZ.CLIENT_UNIT_NM AS CLIENT_UNIT\\nFROM PGMPDM.PROC_HEADR_FCT H\\n\\nINNER JOIN PGMPDM.PROC_TYPE_DIM PT ON PT.PROC_TYPE_DIM_UID = H.PROC_TYPE_DIM_UID AND PT.ROW_STAT_CD <> \\'D\\'\\nINNER JOIN PGMPDM.PROC_DIM P ON P.PROC_DIM_UID = H.PROC_DIM_UID AND P.ROW_STAT_CD <> \\'D\\'\\nINNER JOIN PGMPDM.CNTRCT_DIM C ON C.CNTRCT_DIM_UID = P.CNTRCT_DIM_UID AND C.ROW_STAT_CD <> \\'D\\'\\n\\nINNER JOIN PGMPDM.CNTRCT_TYPE_DIM CT ON CT.CNTRCT_TYPE_DIM_UID = C.CNTRCT_TYPE_DIM_UID AND CT.ROW_STAT_CD <> \\'D\\'\\n--INNER JOIN PGMPDM.WKFLW_DEF_DIM I ON I.WKFLW_DEF_DIM_UID = H.INIT_WKFLW_DEF_DIM_UID AND I.ROW_STAT_CD <> \\'D\\'\\nINNER JOIN PGMPDM.WKFLW_DEF_DIM W ON W.WKFLW_DEF_DIM_UID = H.WKFLW_DEF_DIM_UID AND W.ROW_STAT_CD <> \\'D\\'  \\n\\nINNER JOIN PGMPDM.WKFLW_STEP_DEF_DIM WS ON WS.WKFLW_STEP_DEF_DIM_UID = H.WKFLW_STEP_DEF_DIM_UID AND WS.ROW_STAT_CD <> \\'D\\' \\nINNER JOIN PGMPDM.STATE_DIM ST ON ST.STATE_DIM_UID = H.STATE_DIM_UID AND ST.ROW_STAT_CD <> \\'D\\'\\nINNER JOIN PGMPDM.PROC_STEP_DAT_DIM PS ON P.PROC_DIM_UID = PS.PROC_DIM_UID AND P.CURR_PROC_STEP_DAT_DIM_UID = PS.PROC_STEP_DAT_DIM_UID AND PS.ROW_STAT_CD <> \\'D\\'\\n\\nINNER JOIN PGMPDM.GEO_DIM GEO ON 1=1\\n-- GEO.GEO_DIM_UID = H.GEO_DIM_UID AND GEO.ROW_STAT_CD <> \\'D\\'\\nINNER JOIN PGMPDM.MISC_FCT F ON F.PROC_HEADR_FCT_UID = H.PROC_HEADR_FCT_UID AND F.ROW_STAT_CD <> \\'D\\'\\nINNER JOIN PGMPDM.CNTRCT_CHG_DIM CC ON CC.CNTRCT_CHG_DIM_UID = P.PROC_DIM_UID AND CC.ROW_STAT_CD <> \\'D\\'\\n\\nINNER JOIN PGMPDM.SRC_SYS_DIM SR ON SR.SRC_SYS_DIM_UID = H.SRC_SYS_DIM_UID AND SR.ROW_STAT_CD <> \\'D\\'\\nINNER JOIN PGMPDM.SCTR_DIM SD ON SD.SCTR_DIM_UID = C.SCTR_DIM_UID AND SD.ROW_STAT_CD <> \\'D\\'\\n\\nLEFT OUTER JOIN PGMPDM.STAT_DIM S ON S.STAT_DIM_UID = H.STAT_DIM_UID AND S.ROW_STAT_CD <> \\'D\\'\\nLEFT OUTER JOIN PGMPDM.MISC_REP_REF MR ON MIS_REP_REF_UID = 3\\n\\nLEFT OUTER JOIN PGMPDM.USER_DIM UD ON UD.USER_ID = PS.ASSGN_TO_NUM AND UD.ROW_STAT_CD <> \\'D\\'\\nLEFT OUTER JOIN PGMPDM.ADNC_DIM AU ON AU.ADNC_CD = P.ADNC_CD\\nLEFT OUTER JOIN PGMPDM.PRIORITY_DIM PD ON PD.PRIORITY_NUM = P.PRIORTY_NUM\\n\\nLEFT OUTER JOIN PGMPDM.COND_DIM CN ON CN.COND_CD = P.CNDTN_CD\\nLEFT OUTER JOIN APPFUN.PROC_REGION_V RGN ON RGN.PROC_ID = P.PROC_DIM_UID AND RGN.INTERNAL_VAL <> \\'NONE\\'\\nLEFT OUTER JOIN PGMPDM.USER_DIM CR ON CR.USER_DIM_UID = H.CRETD_BY_USER_DIM_UID AND CR.ROW_STAT_CD <> \\'D\\'\\n\\nLEFT OUTER JOIN PGMPDM.NOTES_DIM ND ON ND.PROC_DIM_UID = P.PROC_DIM_UID AND ND.ROW_STAT_CD <> \\'D\\' AND ND.NOTE_TYPE_CD = \\'I\\' AND ND.LATEST_NOTE_IND = \\'Y\\'\\nLEFT OUTER JOIN PGMPDM.NOTES_DIM PN ON PN.PROC_DIM_UID = P.PROC_DIM_UID AND PN.ROW_STAT_CD <> \\'D\\' AND PN.NOTE_TYPE_CD = \\'P\\' AND PN.LATEST_NOTE_IND = \\'Y\\'\\nLEFT OUTER JOIN PGMPDM.ON_HOLD_DIM O ON O.ON_HOLD_DIM_UID = H.ON_HOLD_DIM_UID AND O.ROW_STAT_CD <> \\'D\\'\\n\\nLEFT OUTER JOIN PGMPDM.ON_HOLD_RSN_DIM HR ON HR.ON_HOLD_RSN_ID = P.ON_HOLD_RSN_ID AND HR.ROW_STAT_CD <> \\'D\\'\\nLEFT OUTER JOIN PGMPDM.PROC_DIM PC ON PC.PROC_DIM_UID = P.PARNT_PROC_ID AND PC.ROW_STAT_CD <> \\'D\\'\\nLEFT OUTER JOIN PGMPDM.PROC_CSTM_DATA_PUBLIC_DIM DP ON DP.PROC_DIM_UID = P.PROC_DIM_UID\\n\\nLEFT OUTER JOIN PGMPDM.PROC_CSTM_DATA_IBM_CLIENT_DIM DI ON DI.PROC_DIM_UID = P.PROC_DIM_UID\\nLEFT OUTER JOIN PGMPDM.ORG_CNTRCT_MAP_DIM OM ON OM.CNTRCT_DIM_UID = C.CNTRCT_DIM_UID\\nLEFT OUTER JOIN PGMPDM.ORGNZN_DIM OD ON OD.ORGNZN_DIM_UID = OM.ORGNZN_DIM_UID\\n\\nLEFT OUTER JOIN PGMPDM.STAT_OF_ORGNZN_DIM SO ON SO.STAT_OF_ORGNZN_DIM_UID = OD.STAT_OF_ORGNZN_DIM_UID\\n--LEFT OUTER JOIN PGMPDM.CNTRCT_TZ_V AF ON C.CNTRCT_DIM_UID = AF.CNTRCT_DIM_UID\\nLEFT OUTER JOIN PGMPDM.ZAUX_CNTRCT_GLBL_BUY_GRP_MAP Z ON Z.CNTRCT_DIM_UID = C.CNTRCT_DIM_UID \\n\\nWHERE H.ROW_STAT_CD <> \\'D\\' AND PT.PROC_TYPE_ID = \\'CONTRCHG\\' AND P.ADNC_ACCSS_CD <> \\'C\\' AND H.DELD_DT IS NULL AND SR.SRC_SYS_CD = \\'PGMP\\'\\n\\n\\n\\n',",
				"     isolationLevel: 'READ_UNCOMMITTED') ~> Srccntrchnagrpt",
				"Srccntrchnagrpt alterRow(upsertIf(true())) ~> AlterRow1",
				"AlterRow1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'table',",
				"     store: 'sqlserver',",
				"     schemaName: 'PGMPDM',",
				"     tableName: 'PGMPDM.CONTRACT_CHANGE_RPT',",
				"     insertable: false,",
				"     updateable: false,",
				"     deletable: false,",
				"     upsertable: true,",
				"     keys:['UNIQUE_ID'],",
				"     skipKeyWrites:true,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError') ~> tgtcntrctchngrpt"
			]
		}
	}
}